{"ast":null,"code":"var _jsxFileName = \"E:\\\\Du_An_300tr\\\\frontend\\\\src\\\\components\\\\ChamCong\\\\FaceRecognition.jsx\",\n  _s = $RefreshSig$();\nimport React, { useRef, useEffect, useState } from 'react';\nimport * as faceapi from 'face-api.js';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst FaceRecognition = ({\n  onRegisterFace,\n  onCheckIn,\n  mode,\n  selectedEmployee,\n  disabled = false\n}) => {\n  _s();\n  const videoRef = useRef();\n  const canvasRef = useRef();\n  const intervalRef = useRef(null);\n  const modeRef = useRef(mode);\n  const [isModelLoaded, setIsModelLoaded] = useState(false);\n  const [faceDetected, setFaceDetected] = useState(false);\n  const [scanningProgress, setScanningProgress] = useState(0);\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [errorMsg, setErrorMsg] = useState('');\n  useEffect(() => {\n    modeRef.current = mode;\n  }, [mode]);\n  useEffect(() => {\n    loadModels();\n    return () => {\n      stopVideo();\n      if (intervalRef.current) clearInterval(intervalRef.current);\n    };\n  }, []);\n  const loadModels = async () => {\n    try {\n      const MODEL_URL = process.env.PUBLIC_URL + '/models';\n      await Promise.all([faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL + '/tiny_face_detector'), faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL + '/face_landmark_68'), faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL + '/face_recognition')]);\n      setIsModelLoaded(true);\n      startVideo();\n    } catch (error) {\n      console.error('❌ Lỗi khi tải mô hình:', error);\n    }\n  };\n  const startVideo = async () => {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({\n        video: {\n          width: 640,\n          height: 480\n        }\n      });\n      if (videoRef.current) {\n        videoRef.current.srcObject = stream;\n      }\n    } catch (error) {\n      console.error('❌ Không thể truy cập camera:', error);\n    }\n  };\n  const stopVideo = () => {\n    if (videoRef.current && videoRef.current.srcObject) {\n      videoRef.current.srcObject.getTracks().forEach(track => track.stop());\n    }\n  };\n  const convertErrorMessage = raw => {\n    try {\n      var _parsed$message, _parsed$message2;\n      const parsed = typeof raw === 'string' ? JSON.parse(raw) : raw;\n      if (parsed !== null && parsed !== void 0 && (_parsed$message = parsed.message) !== null && _parsed$message !== void 0 && _parsed$message.includes('đã được đăng ký')) {\n        const match = parsed.message.match(/nhân viên: (.+)/);\n        const name = (match === null || match === void 0 ? void 0 : match[1]) || 'người khác';\n        return `Khuôn mặt này đã được đăng ký cho nhân viên \"${name}\". Vui lòng thử lại với người khác.`;\n      }\n      if (parsed !== null && parsed !== void 0 && (_parsed$message2 = parsed.message) !== null && _parsed$message2 !== void 0 && _parsed$message2.includes('Không tìm thấy nhân viên phù hợp')) {\n        return 'Không nhận diện được khuôn mặt phù hợp. Vui lòng thử lại.';\n      }\n      return (parsed === null || parsed === void 0 ? void 0 : parsed.message) || 'Đã xảy ra lỗi không xác định.';\n    } catch {\n      // fallback khi không parse được\n      if (typeof raw === 'string' && raw.includes('đã được đăng ký')) {\n        const match = raw.match(/nhân viên: (.+)/);\n        const name = (match === null || match === void 0 ? void 0 : match[1]) || 'người khác';\n        return `Khuôn mặt này đã được đăng ký cho nhân viên \"${name}\".`;\n      }\n      return 'Đã xảy ra lỗi. Vui lòng thử lại.';\n    }\n  };\n  const handleVideoPlay = () => {\n    if (!isModelLoaded || disabled) return;\n    if (!videoRef.current || videoRef.current.readyState < 2) return; // Đảm bảo video đã sẵn sàng\n\n    const canvas = faceapi.createCanvasFromMedia(videoRef.current);\n    canvasRef.current.innerHTML = '';\n    canvasRef.current.appendChild(canvas);\n    const displaySize = {\n      width: videoRef.current.width,\n      height: videoRef.current.height\n    };\n    faceapi.matchDimensions(canvas, displaySize);\n    const detectFaces = async () => {\n      if (!videoRef.current || disabled || isProcessing) return;\n      const detections = await faceapi.detectAllFaces(videoRef.current, new faceapi.TinyFaceDetectorOptions()).withFaceLandmarks().withFaceDescriptors();\n      const resizedDetections = faceapi.resizeResults(detections, displaySize);\n      const ctx = canvas.getContext('2d');\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n      faceapi.draw.drawDetections(canvas, resizedDetections);\n      faceapi.draw.drawFaceLandmarks(canvas, resizedDetections);\n      if (detections.length > 0) {\n        setFaceDetected(true);\n        setIsProcessing(true);\n        setScanningProgress(prev => {\n          const newProgress = Math.min(prev + 25, 100);\n          if (newProgress >= 100 && prev < 100) {\n            const faceDescriptor = detections[0].descriptor;\n            setTimeout(async () => {\n              try {\n                setErrorMsg('');\n                if (modeRef.current === 'register') {\n                  await (onRegisterFace === null || onRegisterFace === void 0 ? void 0 : onRegisterFace(faceDescriptor));\n                } else {\n                  await (onCheckIn === null || onCheckIn === void 0 ? void 0 : onCheckIn(faceDescriptor));\n                }\n              } catch (error) {\n                var _error$response;\n                console.error('❌ Lỗi xử lý khuôn mặt:', error);\n                const rawMsg = (error === null || error === void 0 ? void 0 : error.message) || (error === null || error === void 0 ? void 0 : (_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.data) || 'Lỗi không xác định.';\n                const userFriendlyMsg = convertErrorMessage(rawMsg);\n                setErrorMsg(userFriendlyMsg);\n              } finally {\n                setIsProcessing(false);\n                setScanningProgress(0);\n              }\n            }, 500);\n          } else {\n            setIsProcessing(false);\n          }\n          return newProgress;\n        });\n      } else {\n        setFaceDetected(false);\n        setScanningProgress(0);\n        setIsProcessing(false);\n      }\n    };\n    if (intervalRef.current) clearInterval(intervalRef.current);\n    intervalRef.current = setInterval(detectFaces, 1000);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      position: 'relative',\n      width: 640,\n      height: 480,\n      background: '#fff',\n      borderRadius: 20,\n      border: `3px solid ${faceDetected ? '#28a745' : '#dc3545'}`,\n      overflow: 'hidden',\n      margin: '0 auto',\n      boxShadow: '0 2px 12px rgba(0,0,0,0.08)',\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"video\", {\n      ref: videoRef,\n      width: \"640\",\n      height: \"480\",\n      autoPlay: true,\n      muted: true,\n      onPlay: handleVideoPlay,\n      style: {\n        borderRadius: '20px',\n        width: '640px',\n        height: '480px',\n        objectFit: 'cover',\n        background: '#fff',\n        display: 'block'\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      ref: canvasRef,\n      style: {\n        position: 'absolute',\n        top: 0,\n        left: 0,\n        width: '640px',\n        height: '480px',\n        pointerEvents: 'none'\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 191,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: 'absolute',\n        top: '10px',\n        left: '10px',\n        backgroundColor: 'rgba(0,0,0,0.7)',\n        color: 'white',\n        padding: '5px 10px',\n        borderRadius: '5px',\n        fontSize: '12px'\n      },\n      children: !isModelLoaded ? '⏳ Đang tải mô hình...' : disabled ? '⏸️ Tạm dừng' : faceDetected ? '✅ Đã phát hiện khuôn mặt' : '❌ Không phát hiện'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 203,\n      columnNumber: 7\n    }, this), scanningProgress > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: 'absolute',\n        bottom: '10px',\n        left: '10px',\n        right: '10px',\n        backgroundColor: 'rgba(0,0,0,0.7)',\n        borderRadius: '10px',\n        padding: '5px'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          width: `${scanningProgress}%`,\n          height: '10px',\n          backgroundColor: '#28a745',\n          borderRadius: '5px',\n          transition: 'width 0.3s ease'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 228,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          color: 'white',\n          textAlign: 'center',\n          fontSize: '12px',\n          marginTop: '2px'\n        },\n        children: [mode === 'register' ? 'Đang đăng ký...' : 'Đang nhận diện...', \" \", scanningProgress, \"%\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 235,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 219,\n      columnNumber: 9\n    }, this), errorMsg && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: 'absolute',\n        bottom: '60px',\n        left: '10px',\n        right: '10px',\n        backgroundColor: '#dc3545',\n        color: 'white',\n        padding: '6px 10px',\n        borderRadius: '6px',\n        fontSize: '13px',\n        textAlign: 'center'\n      },\n      children: [\"\\u26A0\\uFE0F \", errorMsg]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 247,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 159,\n    columnNumber: 5\n  }, this);\n};\n_s(FaceRecognition, \"9K+Vo9UDvxz2X+8oXYmUfgk+C3A=\");\n_c = FaceRecognition;\nexport default FaceRecognition;\nvar _c;\n$RefreshReg$(_c, \"FaceRecognition\");","map":{"version":3,"names":["React","useRef","useEffect","useState","faceapi","jsxDEV","_jsxDEV","FaceRecognition","onRegisterFace","onCheckIn","mode","selectedEmployee","disabled","_s","videoRef","canvasRef","intervalRef","modeRef","isModelLoaded","setIsModelLoaded","faceDetected","setFaceDetected","scanningProgress","setScanningProgress","isProcessing","setIsProcessing","errorMsg","setErrorMsg","current","loadModels","stopVideo","clearInterval","MODEL_URL","process","env","PUBLIC_URL","Promise","all","nets","tinyFaceDetector","loadFromUri","faceLandmark68Net","faceRecognitionNet","startVideo","error","console","stream","navigator","mediaDevices","getUserMedia","video","width","height","srcObject","getTracks","forEach","track","stop","convertErrorMessage","raw","_parsed$message","_parsed$message2","parsed","JSON","parse","message","includes","match","name","handleVideoPlay","readyState","canvas","createCanvasFromMedia","innerHTML","appendChild","displaySize","matchDimensions","detectFaces","detections","detectAllFaces","TinyFaceDetectorOptions","withFaceLandmarks","withFaceDescriptors","resizedDetections","resizeResults","ctx","getContext","clearRect","draw","drawDetections","drawFaceLandmarks","length","prev","newProgress","Math","min","faceDescriptor","descriptor","setTimeout","_error$response","rawMsg","response","data","userFriendlyMsg","setInterval","style","position","background","borderRadius","border","overflow","margin","boxShadow","display","justifyContent","alignItems","children","ref","autoPlay","muted","onPlay","objectFit","fileName","_jsxFileName","lineNumber","columnNumber","top","left","pointerEvents","backgroundColor","color","padding","fontSize","bottom","right","transition","textAlign","marginTop","_c","$RefreshReg$"],"sources":["E:/Du_An_300tr/frontend/src/components/ChamCong/FaceRecognition.jsx"],"sourcesContent":["import React, { useRef, useEffect, useState } from 'react';\nimport * as faceapi from 'face-api.js';\n\nconst FaceRecognition = ({ onRegisterFace, onCheckIn, mode, selectedEmployee, disabled = false }) => {\n  const videoRef = useRef();\n  const canvasRef = useRef();\n  const intervalRef = useRef(null);\n  const modeRef = useRef(mode);\n\n  const [isModelLoaded, setIsModelLoaded] = useState(false);\n  const [faceDetected, setFaceDetected] = useState(false);\n  const [scanningProgress, setScanningProgress] = useState(0);\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [errorMsg, setErrorMsg] = useState('');\n\n  useEffect(() => {\n    modeRef.current = mode;\n  }, [mode]);\n\n  useEffect(() => {\n    loadModels();\n    return () => {\n      stopVideo();\n      if (intervalRef.current) clearInterval(intervalRef.current);\n    };\n  }, []);\n\n  const loadModels = async () => {\n    try {\n      const MODEL_URL = process.env.PUBLIC_URL + '/models';\n      await Promise.all([\n        faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL + '/tiny_face_detector'),\n        faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL + '/face_landmark_68'),\n        faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL + '/face_recognition'),\n      ]);\n      setIsModelLoaded(true);\n      startVideo();\n    } catch (error) {\n      console.error('❌ Lỗi khi tải mô hình:', error);\n    }\n  };\n\n  const startVideo = async () => {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({\n        video: { width: 640, height: 480 }\n      });\n      if (videoRef.current) {\n        videoRef.current.srcObject = stream;\n      }\n    } catch (error) {\n      console.error('❌ Không thể truy cập camera:', error);\n    }\n  };\n\n  const stopVideo = () => {\n    if (videoRef.current && videoRef.current.srcObject) {\n      videoRef.current.srcObject.getTracks().forEach(track => track.stop());\n    }\n  };\n\n  const convertErrorMessage = (raw) => {\n    try {\n      const parsed = typeof raw === 'string' ? JSON.parse(raw) : raw;\n      if (parsed?.message?.includes('đã được đăng ký')) {\n        const match = parsed.message.match(/nhân viên: (.+)/);\n        const name = match?.[1] || 'người khác';\n        return `Khuôn mặt này đã được đăng ký cho nhân viên \"${name}\". Vui lòng thử lại với người khác.`;\n      }\n      if (parsed?.message?.includes('Không tìm thấy nhân viên phù hợp')) {\n        return 'Không nhận diện được khuôn mặt phù hợp. Vui lòng thử lại.';\n      }\n      return parsed?.message || 'Đã xảy ra lỗi không xác định.';\n    } catch {\n      // fallback khi không parse được\n      if (typeof raw === 'string' && raw.includes('đã được đăng ký')) {\n        const match = raw.match(/nhân viên: (.+)/);\n        const name = match?.[1] || 'người khác';\n        return `Khuôn mặt này đã được đăng ký cho nhân viên \"${name}\".`;\n      }\n      return 'Đã xảy ra lỗi. Vui lòng thử lại.';\n    }\n  };\n\n  const handleVideoPlay = () => {\n    if (!isModelLoaded || disabled) return;\n    if (!videoRef.current || videoRef.current.readyState < 2) return; // Đảm bảo video đã sẵn sàng\n\n    const canvas = faceapi.createCanvasFromMedia(videoRef.current);\n    canvasRef.current.innerHTML = '';\n    canvasRef.current.appendChild(canvas);\n\n    const displaySize = {\n      width: videoRef.current.width,\n      height: videoRef.current.height\n    };\n    faceapi.matchDimensions(canvas, displaySize);\n\n    const detectFaces = async () => {\n      if (!videoRef.current || disabled || isProcessing) return;\n\n      const detections = await faceapi\n        .detectAllFaces(videoRef.current, new faceapi.TinyFaceDetectorOptions())\n        .withFaceLandmarks()\n        .withFaceDescriptors();\n\n      const resizedDetections = faceapi.resizeResults(detections, displaySize);\n      const ctx = canvas.getContext('2d');\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n      faceapi.draw.drawDetections(canvas, resizedDetections);\n      faceapi.draw.drawFaceLandmarks(canvas, resizedDetections);\n\n      if (detections.length > 0) {\n        setFaceDetected(true);\n        setIsProcessing(true);\n\n        setScanningProgress(prev => {\n          const newProgress = Math.min(prev + 25, 100);\n\n          if (newProgress >= 100 && prev < 100) {\n            const faceDescriptor = detections[0].descriptor;\n\n            setTimeout(async () => {\n              try {\n                setErrorMsg('');\n                if (modeRef.current === 'register') {\n                  await onRegisterFace?.(faceDescriptor);\n                } else {\n                  await onCheckIn?.(faceDescriptor);\n                }\n              } catch (error) {\n                console.error('❌ Lỗi xử lý khuôn mặt:', error);\n                const rawMsg = error?.message || error?.response?.data || 'Lỗi không xác định.';\n                const userFriendlyMsg = convertErrorMessage(rawMsg);\n                setErrorMsg(userFriendlyMsg);\n              } finally {\n                setIsProcessing(false);\n                setScanningProgress(0);\n              }\n            }, 500);\n          } else {\n            setIsProcessing(false);\n          }\n\n          return newProgress;\n        });\n      } else {\n        setFaceDetected(false);\n        setScanningProgress(0);\n        setIsProcessing(false);\n      }\n    };\n\n    if (intervalRef.current) clearInterval(intervalRef.current);\n    intervalRef.current = setInterval(detectFaces, 1000);\n  };\n\n  return (\n    <div\n      style={{\n        position: 'relative',\n        width: 640,\n        height: 480,\n        background: '#fff',\n        borderRadius: 20,\n        border: `3px solid ${faceDetected ? '#28a745' : '#dc3545'}`,\n        overflow: 'hidden',\n        margin: '0 auto',\n        boxShadow: '0 2px 12px rgba(0,0,0,0.08)',\n        display: 'flex',\n        justifyContent: 'center',\n        alignItems: 'center'\n      }}\n    >\n      <video\n        ref={videoRef}\n        width=\"640\"\n        height=\"480\"\n        autoPlay\n        muted\n        onPlay={handleVideoPlay}\n        style={{\n          borderRadius: '20px',\n          width: '640px',\n          height: '480px',\n          objectFit: 'cover',\n          background: '#fff',\n          display: 'block'\n        }}\n      />\n      <div\n        ref={canvasRef}\n        style={{\n          position: 'absolute',\n          top: 0,\n          left: 0,\n          width: '640px',\n          height: '480px',\n          pointerEvents: 'none'\n        }}\n      />\n\n      <div style={{\n        position: 'absolute',\n        top: '10px',\n        left: '10px',\n        backgroundColor: 'rgba(0,0,0,0.7)',\n        color: 'white',\n        padding: '5px 10px',\n        borderRadius: '5px',\n        fontSize: '12px'\n      }}>\n        {!isModelLoaded ? '⏳ Đang tải mô hình...' :\n         disabled ? '⏸️ Tạm dừng' :\n         faceDetected ? '✅ Đã phát hiện khuôn mặt' : '❌ Không phát hiện'}\n      </div>\n\n      {scanningProgress > 0 && (\n        <div style={{\n          position: 'absolute',\n          bottom: '10px',\n          left: '10px',\n          right: '10px',\n          backgroundColor: 'rgba(0,0,0,0.7)',\n          borderRadius: '10px',\n          padding: '5px'\n        }}>\n          <div style={{\n            width: `${scanningProgress}%`,\n            height: '10px',\n            backgroundColor: '#28a745',\n            borderRadius: '5px',\n            transition: 'width 0.3s ease'\n          }} />\n          <div style={{\n            color: 'white',\n            textAlign: 'center',\n            fontSize: '12px',\n            marginTop: '2px'\n          }}>\n            {mode === 'register' ? 'Đang đăng ký...' : 'Đang nhận diện...'} {scanningProgress}%\n          </div>\n        </div>\n      )}\n\n      {errorMsg && (\n        <div style={{\n          position: 'absolute',\n          bottom: '60px',\n          left: '10px',\n          right: '10px',\n          backgroundColor: '#dc3545',\n          color: 'white',\n          padding: '6px 10px',\n          borderRadius: '6px',\n          fontSize: '13px',\n          textAlign: 'center'\n        }}>\n          ⚠️ {errorMsg}\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default FaceRecognition;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}